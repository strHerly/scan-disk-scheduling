<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SCAN Disk Scheduling Simulator</title>
  <style>
    :root {
      --white: #ffffff;
      --light-gray: #f5f6fa;
      --border-gray: #e0e0e0;
      --text-dark: #2c3e50;
      --blue: #007bff;
      --green: #27ae60;
      --red: #e74c3c;
      --shadow: 0 4px 10px rgba(0,0,0,0.05);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "Inter", "Segoe UI", sans-serif;
      background: var(--light-gray);
      color: var(--text-dark);
      height: 100vh;
      display: flex;
      overflow: hidden;
    }

    .container {
      display: flex;
      width: 100%;
      height: 100%;
    }

    /* Sidebar */
    .sidebar {
      width: 360px;
      background: rgba(255,255,255,0.9);
      backdrop-filter: blur(6px);
      border-right: 1px solid var(--border-gray);
      box-shadow: var(--shadow);
      padding: 24px;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 1.4rem;
      color: var(--text-dark);
      margin-bottom: 6px;
      letter-spacing: 0.5px;
    }

    .description {
      font-size: 0.9rem;
      color: #666;
    }

    .info-icon {
      position: absolute;
      right: 20px;
      top: 20px;
      background: none;
      border: none;
      font-size: 1.1rem;
      color: var(--blue);
      cursor: pointer;
    }

    .input-panel {
      background: var(--white);
      border: 1px solid var(--border-gray);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 20px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 0.9rem;
    }

    input, select {
      width: 100%;
      padding: 10px;
      font-size: 0.95rem;
      border: 1px solid var(--border-gray);
      border-radius: 8px;
      outline: none;
      transition: border 0.2s;
    }

    input:focus, select:focus {
      border-color: var(--blue);
    }

    .button-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    button {
      flex: 1;
      padding: 10px 0;
      font-weight: 600;
      font-size: 0.95rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      transition: all 0.2s ease;
    }

    button:hover:not(:disabled) {
      transform: translateY(-1px);
      opacity: 0.95;
    }

    button:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .run-btn { background: var(--blue); }
    .random-btn { background: var(--green); }
    .pause-btn { background: var(--red); }

    /* Results */
    .results .metric-card {
      background: linear-gradient(135deg, #ffffff, #f4f9ff);
      border: 2px solid #dceeff;
      border-radius: 16px;
      padding: 18px;
      text-align: center;
      margin-bottom: 12px;
      box-shadow: var(--shadow);
    }

    .results .metric-card h3 {
      font-size: 0.9rem;
      color: #4c5b6b;
      margin-bottom: 6px;
    }

    .results .metric-card .big-value {
      font-size: 2.4rem;
      font-weight: 800;
      color: var(--blue);
      letter-spacing: 1px;
    }

    /* Force hidden state — prevents flashing */
    .results {
      opacity: 0 !important;
      transform: translateY(10px);
      pointer-events: none;
      display: none;      /* <-- important */
    }

    /* Only show when animation finishes */
    .results.visible {
      display: block;     /* <-- added */
      opacity: 1 !important;
      transform: translateY(0);
      pointer-events: auto;
    }

    .seek-details {
      margin-top: 15px;
      background: var(--white);
      border: 1px solid var(--border-gray);
      padding: 14px;
      border-radius: 10px;
      box-shadow: var(--shadow);
      font-family: 'Segoe UI', sans-serif;
    }

  .seek-details h3 {
    margin-bottom: 10px;
    color: var(--blue);
    font-size: 1rem;
    font-weight: 700;
  }

  .movement-step {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(90deg, rgba(245,246,250,1) 0%, rgba(255,255,255,1) 100%);
    border: 1px solid #eaeaea;
    border-radius: 8px;
    padding: 6px 12px;
    margin-bottom: 6px;
    font-size: 0.9rem;
    color: var(--text-dark);
    transition: all 0.2s ease;
  }

  .movement-step:hover {
    background: #f0f7ff;
    border-color: #d0e4ff;
    transform: translateX(2px);
  }

  .movement-step span:first-child {
    font-weight: 600;
  }

  .movement-step span:last-child {
    color: var(--blue);
    font-weight: 500;
  }

  .movement-step.total-line {
    background: var(--blue);
    color: white;
    border: none;
    font-weight: 700;
    font-size: 1rem;
    justify-content: center;
    letter-spacing: 0.3px;
    margin-top: 10px;
    padding: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .movement-step.total-line span {
    color: white;
  }

  .movement-step.active {
  background: #e6f2ff;
  border-color: var(--blue);
  transform: scale(1.02);
}


    /* Main visualization */
    .main-content {
      flex: 1;
      background: var(--white);
      margin: 16px;
      border-radius: 16px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      padding: 20px;
    }

    .visualization-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      border: 1px solid var(--border-gray);
      border-radius: 12px;
      background: var(--white);
      padding: 10px;
      position: relative;
    }

    #visualization {
      width: 100%;
      height: 100%;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(4px);
      justify-content: center;
      align-items: center;
    }

   .modal-content {
  background: var(--white);
  padding: 30px;
  border-radius: 16px;
  width: 420px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.15);
  animation: fadeIn 0.25s ease;
}

.modal-content h2 {
  font-size: 1.4rem;
  margin-bottom: 10px;
  font-weight: 700;
}

.modal-content ul li {
  margin-bottom: 6px;
  line-height: 1.5rem;
}

/* ✅ Legend redesign */
.legend-item {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
  font-size: 0.95rem;
}

/* Blue line icon for movement */
.legend-line {
  width: 28px;
  height: 4px;
  border-radius: 2px;
  background: #3498db;
}

/* Dot icons */
.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
}

.legend-head {
  width: 0;
  height: 0;
  border-left: 7px solid transparent;
  border-right: 7px solid transparent;
  border-bottom: 12px solid #e74c3c; /* red */
  transform: rotate(90deg); /* makes it point right */
}
.legend-request { background: #2c3e50; }

/* animation */
@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to   { opacity: 1; transform: translateY(0); }
}

    .close-btn {
      background: var(--blue);
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      float: right;
      cursor: pointer;
    }
    .results {
    background: var(--white);
    border-radius: 12px;
    border: 1px solid var(--border-gray);
    padding: 16px;
    box-shadow: var(--shadow);
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.6s ease;
    pointer-events: none;
    }

    .results.visible {
    opacity: 1;
    transform: translateY(0);
    pointer-events: all;
    }

    /* ✅ Toast Error Notification */
  .toast {
    position: fixed;
    bottom: 30px;
    right: 30px;
    background: #e74c3c;
    padding: 16px 22px;
    border-radius: 12px;
    color: white;
    font-size: 0.95rem;
    font-weight: 600;
    box-shadow: 0 6px 18px rgba(0,0,0,0.15);
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.4s ease, transform 0.4s ease;
    z-index: 2000;
  }
  .toast.show {
    opacity: 1;
    transform: translateY(0);
  }
  /* === Invalid input visual + shake === */
.input-error {
  border: 2px solid #e74c3c !important;
  animation: shake 0.35s ease;
}

@keyframes shake {
  0% { transform: translateX(0px); }
  20% { transform: translateX(-6px); }
  40% { transform: translateX(6px); }
  60% { transform: translateX(-4px); }
  80% { transform: translateX(4px); }
  100% { transform: translateX(0px); }
}


  </style>
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <header>
        <h1>SCAN Disk Scheduling</h1>
        <p class="description">A clean visual simulation of the SCAN algorithm.</p>
        <button class="info-icon" onclick="openModal()">ℹ️</button>
      </header>

      <section class="input-panel">
        <div class="input-group">
          <label>Request Queue</label>
          <input id="requestQueue" value="176, 79, 34, 60, 92, 11, 41, 114" />
        </div>
        <div class="input-group">
          <label>Initial Head Position</label>
          <input type="number" id="initialHead" value="50" />
        </div>
        <div class="input-group">
          <label>Disk Size</label>
          <input type="number" id="diskSize" value="200" />
        </div>
        <div class="input-group">
          <label>Initial Direction</label>
          <select id="direction">
            <option value="left">Left</option>
            <option value="right">Right</option>
          </select>
        </div>

        <div class="button-row">
          <button class="run-btn" onclick="runSimulation()">Run</button>
          <button class="random-btn" onclick="randomizeValues()">Random</button>
          <button class="pause-btn" id="pauseBtn" onclick="pauseAnimation()" disabled>⏸</button>
        </div>
      </section>

      <section class="results">
        <h2>Results</h2>
        <div class="metric-card">
          <h3>Total Head Movement (Seek Time)</h3>
          <div id="totalMovement" class="big-value">-</div>
        </div>

        <div class="metrics">
          <div>
            <p>Sequence:</p>
            <div id="sequence" class="metric-value">-</div>
          </div>
        </div>

        <div class="seek-details">
          <h3>Seek Time Calculation:</h3>
          <div id="seekCalculation"></div>

          <button id="fullCalcBtn" onclick="openCalcModal()" style="margin-top:12px; width: 100%; background:#007bff; padding:10px; border-radius:8px; border:none; color:white; cursor:pointer;">
            Show Full Calculation
          </button>
        </div>

      </section>
    </div>

    <div class="main-content">
      <div class="visualization-container">
        <canvas id="visualization"></canvas>
      </div>
    </div>
  </div>

  <div id="infoModal" class="modal">
    <div class="modal-content">
      <h2>How to Use</h2>
      <ul>
        <li>Enter disk requests and head position.</li>
        <li>Choose direction of initial movement.</li>
        <li>Click <b>Run</b> to start the simulation.</li>
        <li>Click <b>Pause</b> to stop temporarily.</li>
        <li>Use <b>Random</b> for quick random values.</li>
      </ul>
      <div class="legend">
        <h3>Legend:</h3>

        <div class="legend-item">
          <div class="legend-dot legend-head"></div> Head Position
        </div>

        <div class="legend-item">
          <div class="legend-dot legend-request"></div> Request Queue
        </div>

        <div class="legend-item">
          <div class="legend-line"></div> Path of Movement
        </div>

      </div>


      <button class="close-btn" onclick="closeModal()">Close</button>
    </div>
  </div>

  <!-- ✅ Full Calculation Modal -->
  <div id="calcModal" class="modal">
    <div class="modal-content" style="width:500px;">
      <h2>Full Seek Time Calculation</h2>
      <div id="fullCalculation" style="font-size:1rem; margin-top:10px;"></div>

      <button class="close-btn" onclick="closeCalcModal()">Close</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    let resultTimeout = null;

    let chart=null,animationFrameId=null,isAnimating=false,currentAnimationStep=0,animationData=[],animationStartTime=0,lastProgressTime=0;

    function openModal(){document.getElementById('infoModal').style.display='flex';}
    function closeModal(){document.getElementById('infoModal').style.display='none';}

    function randomizeValues(){
      const size=parseInt(document.getElementById('diskSize').value)||200;
      const n=Math.floor(Math.random()*6)+5;
      const q=Array.from({length:n},()=>Math.floor(Math.random()*size));
      const h=Math.floor(Math.random()*size);
      const dir=Math.random()>0.5?'left':'right';
      document.getElementById('requestQueue').value=q.join(', ');
      document.getElementById('initialHead').value=h;
      document.getElementById('direction').value=dir;
      //runSimulation();
    }

    function pauseAnimation(){
      const btn=document.getElementById('pauseBtn');
      if(!isAnimating){
        isAnimating=true;btn.textContent='⏸';
        animationStartTime=Date.now()-lastProgressTime;
        requestAnimationFrame(animate);
      }else{
        isAnimating=false;btn.textContent='▶';
        lastProgressTime=Date.now()-animationStartTime;
        if(animationFrameId)cancelAnimationFrame(animationFrameId);
      }
    }

    function animate() {
      if (!isAnimating) return;

      const animationDuration = 650; // ✅ speed (lower = faster, higher = slower)
      const progress = Math.min(1, (Date.now() - animationStartTime) / animationDuration);

      // ✅ smoother easing curve (easeInOutCubic)
      const ease = t => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);
      const eased = ease(progress);

      const cur = animationData[currentAnimationStep];
      const next = animationData[currentAnimationStep + 1];

      if (!next) return;

      const x = cur.x + (next.x - cur.x) * eased;
      const y = cur.y + (next.y - cur.y) * eased;

      updateChartWithAnimation(x, y);

      if (progress >= 1) {
        currentAnimationStep++;
        animationStartTime = Date.now();
      }

      animationFrameId = requestAnimationFrame(animate);
    }


    function scanAlgorithm(q,head,size,dir){
      let seek=0,left=[],right=[],seq=[],moves=[];
      if(dir==="left")left.push(0);else right.push(size-1);
      for(let r of q){if(r<head)left.push(r);if(r>head)right.push(r);}
      left.sort((a,b)=>a-b);right.sort((a,b)=>a-b);
      let run=2;
      while(run-- >0){
        if(dir==="left"){
          for(let i=left.length-1;i>=0;i--){
            let d=Math.abs(head-left[i]);
            seek+=d;moves.push({from:head,to:left[i],distance:d});head=left[i];seq.push(head);
          }dir="right";
        }else{
          for(let i=0;i<right.length;i++){
            let d=Math.abs(head-right[i]);
            seek+=d;moves.push({from:head,to:right[i],distance:d});head=right[i];seq.push(head);
          }dir="left";
        }
      }
      return{sequence:seq,totalMovement:seek,movements:moves};
    }

    function createVisualization(seq,head,size){
      const ctx=document.getElementById('visualization').getContext('2d');
      if(chart)chart.destroy();
      const data=seq.map((t,i)=>({x:t,y:i+1}));
      data.unshift({x:head,y:0});animationData=data;currentAnimationStep=0;
      chart=new Chart(ctx,{
        type:'line',
        data:{datasets:[
          {data:data,borderColor:'#3498db',borderWidth:2,fill:false,pointRadius:0},
          {data:data.slice(1),borderColor:'transparent',backgroundColor:'#2c3e50',pointRadius:6},
          {data:[{x:data[0].x,y:data[0].y}],borderColor:'#e74c3c',backgroundColor:'#e74c3c',pointRadius:12,pointStyle:'triangle'}
        ]},
        options:{
          responsive:true,maintainAspectRatio:false,
          scales:{
            x:{type:'linear',position:'top',title:{display:true,text:'Track Number'},min:0,max:size},
            y:{reverse:true,title:{display:true,text:'Order'},ticks:{callback:v=>v===0?'Start':`Step ${v}`}}
          },
          plugins:{legend:{display:false}}
        }
      });
    }

    function updateChartWithAnimation(x,y){
      if(!chart)return;
      chart.data.datasets[2].data=[{x,y}];
      const s=Math.floor(y);
      const path=animationData.slice(0,s+1);
      if(s>=0&&s<animationData.length-1)path.push({x,y});
      chart.data.datasets[0].data=path;
      chart.update('none');
    }
    function jumpToStep(stepIndex) {
      if (!chart || !animationData.length) return;

      // Limit stepIndex
      stepIndex = Math.min(stepIndex, animationData.length - 1);

      // Stop current animation
      isAnimating = false;
      if (animationFrameId) cancelAnimationFrame(animationFrameId);

      // Highlight selected card
      const steps = document.querySelectorAll('.movement-step');
      steps.forEach(s => s.classList.remove('active'));
      if (steps[stepIndex - 1]) steps[stepIndex - 1].classList.add('active');

      const current = animationData[currentAnimationStep];
      const target = animationData[stepIndex];
      if (!current || !target) return;

      // Animation settings
      const baseDuration = 600; // base ms
      const distance = Math.abs(target.x - current.x);
      const duration = Math.min(1200, Math.max(400, baseDuration + distance * 2));

      const startTime = performance.now();

      // Smooth easing (easeInOutCubic)
      const ease = t => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);

      function smoothTransition(time) {
        const elapsed = time - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = ease(progress);

        const x = current.x + (target.x - current.x) * eased;
        const y = current.y + (target.y - current.y) * eased;

        // Update line path and head
        const path = animationData.slice(
          0,
          Math.max(currentAnimationStep, stepIndex) + 1
        );

        if (stepIndex < currentAnimationStep) {
          // Going backward: shorten path visually as we go back
          const sliced = animationData.slice(0, stepIndex + 1);
          chart.data.datasets[0].data = sliced.concat({ x, y });
        } else {
          // Going forward
          chart.data.datasets[0].data = path.slice(0, -1).concat({ x, y });
        }

        chart.data.datasets[2].data = [{ x, y }];
        chart.update('none');

        if (progress < 1) {
          requestAnimationFrame(smoothTransition);
        } else {
          currentAnimationStep = stepIndex;
          chart.data.datasets[0].data = animationData.slice(0, stepIndex + 1);
          chart.data.datasets[2].data = [{ x: target.x, y: target.y }];
          chart.update();
        }
      }

      requestAnimationFrame(smoothTransition);

      // Update pause/play button
      const pauseBtn = document.getElementById('pauseBtn');
      pauseBtn.disabled = false;
      pauseBtn.textContent = '▶';
    }


    function runSimulation(){
      try{
        if (resultTimeout) {
          clearTimeout(resultTimeout);
          resultTimeout = null;
        }

        const resultsPanel = document.querySelector('.results');
        resultsPanel.style.display = "none";
        resultsPanel.classList.remove("visible");

        const q = document.getElementById('requestQueue').value
          .split(/[\s,]+/)
          .map(v => parseInt(v.trim()))
          .filter(v => !isNaN(v));

        const head = parseInt(document.getElementById('initialHead').value);
        const size = parseInt(document.getElementById('diskSize').value);
        const dir = document.getElementById('direction').value;

        validateInput(q, head, size);
        const result = scanAlgorithm(q, head, size, dir);

        document.getElementById('totalMovement').textContent = result.totalMovement;
        document.getElementById('sequence').textContent = result.sequence.join(' → ');

        // ✅ Build equation string
        let formula = "";
        let sumParts = [];
        let accumulatedSum = 0;
        let currentHeadPos = parseInt(document.getElementById("initialHead").value);

        // Build ∑ formula
        result.sequence.forEach(req => {
          let diff = Math.abs(currentHeadPos - req);
          sumParts.push(`|${currentHeadPos} - ${req}|`);
          accumulatedSum += diff;
          currentHeadPos = req;
        });

        // Display in modal
        document.getElementById("fullCalculation").innerHTML = `
          <p style="font-size:1.1rem; margin-bottom:8px;"><b>Formula:</b></p>
          <p>∑ | Current Head − Next Request |</p><br>
          <p>${sumParts.join(" + ")} = <b>${result.totalMovement}</b> tracks</p>
        `;


        let html = '';
        result.movements.forEach((m, i) => {
          html += `
            <div class="movement-step" onclick="jumpToStep(${i + 1})">
              <span>Step ${i + 1}: ${m.from} → ${m.to}</span>
              <span>${m.distance} tracks</span>
            </div>`;
        });

        document.getElementById('seekCalculation').innerHTML = html;
        createVisualization(result.sequence, head, size);

        isAnimating = true;
        animationStartTime = Date.now();

        const pauseBtn = document.getElementById('pauseBtn');
        pauseBtn.disabled = false;
        pauseBtn.textContent = '⏸';

        if (animationFrameId) cancelAnimationFrame(animationFrameId);
        animate();

        resultTimeout = setTimeout(() => {
          const resultsPanel = document.querySelector('.results');
          resultsPanel.style.display = "block"; // ensure hidden until animation ends
          requestAnimationFrame(() => resultsPanel.classList.add("visible"));
          resultTimeout = null;
        }, result.movements.length * 600 + 300);


      } catch (err) {
        showError(err.message, err.el);
      }

    }

    function showError(msg, invalidEl = null) {
      const toast = document.getElementById("toast");
      toast.textContent = "⚠️ " + msg;
      toast.classList.add("show");

      if (invalidEl) {
        invalidEl.classList.remove("input-error"); // remove first to retrigger animation

        setTimeout(() => {
          invalidEl.classList.add("input-error");
          invalidEl.focus();
        }, 10);

        // Remove highlight after shake
        setTimeout(() => {
          invalidEl.classList.remove("input-error");
        }, 1000);
      }

      clearTimeout(window._toastTimeout);
      window._toastTimeout = setTimeout(() => {
        toast.classList.remove("show");
      }, 2800);
    }

function validateInput(q, head, size) {
  // disk size numeric & positive
  if (isNaN(size) || size <= 0) {
    const el = document.getElementById('diskSize');
    throw { message: "Disk size must be a positive number.", el };
  }

  // head must be provided and numeric
  if (isNaN(head)) {
    const el = document.getElementById('initialHead');
    throw { message: "Please enter a valid Initial Head Position.", el };
  }

  if (head < 0 || head >= size) {
    const el = document.getElementById('initialHead');
    throw { message: `Initial head must be between 0 and ${size - 1}.`, el };
  }

  if (!q.length) {
    const el = document.getElementById('requestQueue');
    throw { message: "Request queue cannot be empty.", el };
  }

  for (let r of q) {
    if (isNaN(r)) {
      const el = document.getElementById('requestQueue');
      throw { message: "Request queue contains invalid values (non-numeric).", el };
    }
    if (r < 0) {
      const el = document.getElementById('requestQueue');
      throw { message: "Requests cannot be negative.", el };
    }
    if (r >= size) {
      const el = document.getElementById('requestQueue');
      throw { message: `Request ${r} exceeds disk size (${size}).`, el };
    }
  }
}

    function openCalcModal() {
      document.getElementById("calcModal").style.display = "flex";
    }

    function closeCalcModal() {
      document.getElementById("calcModal").style.display = "none";
    }

    //window.onload=runSimulation;
  </script>
  <div id="toast" class="toast"></div>

</body>
</html>
